<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>eKhaya - Your Home, Our Community</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css" />
    <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ›–</text></svg>">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #FDF8F0; /* Warm, inviting off-white */
            color: #4A3B31; /* Deep, earthy brown for text */
            overflow-x: hidden;
            min-height: 100vh;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
        }
        .african-pattern-bg {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-image: url('https://www.transparenttextures.com/patterns/aztec.png');
            opacity: 0.03; z-index: -1;
        }
        .top-bar {
            background-color: rgba(212, 163, 115, 0.9); /* Ochre */
            backdrop-filter: blur(5px);
            padding: 10px 20px; display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky; top: 0; z-index: 1001;
        }
        .logo { font-family: 'Playfair Display', serif; font-size: 1.8rem; font-weight: 700; color: #4A3B31; cursor: pointer; }
        .logo .highlight { color: #E76F51; }
        .auth-buttons button {
            background-color: #E76F51; color: white; padding: 8px 16px; border-radius: 20px;
            font-weight: 500; transition: background-color 0.3s; margin-left: 10px; font-size: 0.9rem;
        }
        .auth-buttons button:hover { background-color: #D95A3F; }
        .auth-buttons .login-btn { background-color: transparent; color: #4A3B31; border: 1px solid #4A3B31; }
        .auth-buttons .login-btn:hover { background-color: #f0e6d5; }

        .main-content-area, .dashboard-page-container { flex-grow: 1; display: flex; flex-direction: column; }
        .homepage-content { display: flex; flex-direction: column; flex-grow: 1; } /* Visible by default */
        .dashboard-page-container { display: none; } /* Hidden by default */

        .hero-carousel-container { height: 55vh; width: 100%; position: relative; }
        .swiper-container { width: 100%; height: 100%; }
        .swiper-slide { display: flex; align-items: center; justify-content: center; text-align: center; background-size: cover; background-position: center; position: relative; }
        .swiper-slide::before { content: ""; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(to bottom, rgba(0,0,0,0.1) 0%, rgba(0,0,0,0.6) 100%); }
        .slide-content { position: relative; z-index: 1; color: white; padding: 20px; max-width: 80%; }
        .slide-content h2 { font-family: 'Playfair Display', serif; font-size: clamp(1.8rem, 4vw, 3rem); font-weight: 700; margin-bottom: 0.5rem; text-shadow: 2px 2px 6px rgba(0,0,0,0.6); }
        .slide-content p { font-size: clamp(0.85rem, 2vw, 1.1rem); margin-bottom: 1.5rem; max-width: 600px; margin-left: auto; margin-right: auto; text-shadow: 1px 1px 4px rgba(0,0,0,0.8); }
        .cta-button { background-color: #E76F51; color: white; padding: 10px 24px; border-radius: 25px; text-decoration: none; font-weight: 600; transition: all 0.3s ease; margin: 5px; font-size: 0.9rem; border: 2px solid transparent; display: inline-block; }
        .cta-button:hover { background-color: #D95A3F; transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        .cta-button-secondary { background-color: transparent; border: 2px solid white; }
        .cta-button-secondary:hover { background-color: rgba(255,255,255,0.2); }

        .icon-hub { flex-grow: 1; display: flex; align-items: center; justify-content: center; padding: 20px 10px; background-color: #F0EFEB; min-height: 35vh; }
        .icon-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); gap: 15px; max-width: 1000px; width: 100%; }
        .icon-item { background-color: #FFFFFF; border: 1px solid #D7CCC8; border-radius: 16px; padding: 15px 10px; text-align: center; cursor: pointer; transition: transform 0.2s ease, box-shadow 0.2s ease; box-shadow: 0 6px 12px rgba(0,0,0,0.05); display: flex; flex-direction: column; align-items: center; justify-content: space-around; min-height: 130px; }
        .icon-item:hover { transform: translateY(-5px) scale(1.02); box-shadow: 0 12px 20px rgba(0,0,0,0.1); }
        .icon-item i { font-size: 2rem; margin-bottom: 10px; color: #E76F51; }
        .icon-item-svg svg { width: 36px; height: 36px; margin-bottom: 10px; fill: #E76F51; }
        .icon-item span { font-size: 0.85rem; font-weight: 600; color: #4A3B31; line-height: 1.2; }

        .modal { display: none; position: fixed; z-index: 1050; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.7); align-items: center; justify-content: center; padding: 15px; }
        .modal-content { background-color: #FEFDFB; margin: auto; padding: 20px 25px; border: 2px solid #D4A373; border-radius: 12px; width: 95%; max-width: 600px; max-height: 90vh; overflow-y: auto; box-shadow: 0 10px 30px rgba(0,0,0,0.2); position: relative; animation: fadeInModal 0.3s ease-out; }
        @keyframes fadeInModal { from { opacity: 0; transform: translateY(-20px) scale(0.95); } to { opacity: 1; transform: translateY(0) scale(1); } }
        .close-button { color: #aaa; position: absolute; top: 10px; right: 15px; font-size: 28px; font-weight: bold; cursor: pointer; transition: color 0.2s; }
        .close-button:hover, .close-button:focus { color: #4A3B31; text-decoration: none; }
        .modal-title { color: #BF360C; font-family: 'Playfair Display', serif; font-size: 1.7rem; font-weight: 700; margin-bottom: 15px; text-align: center; }
        .modal-body h4 { font-size: 1.1rem; font-weight: 600; color: #E76F51; margin-top: 15px; margin-bottom: 8px; }
        .modal-body p, .modal-body ul li { margin-bottom: 10px; line-height: 1.6; color: #5D4037; font-size: 0.9rem; }
        .modal-body ul { list-style-position: inside; padding-left: 5px; }
        .modal-body img { max-width: 100%; height: auto; max-height: 200px; object-fit: cover; border-radius: 8px; margin: 15px auto; display: block; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .modal-body .form-input, .modal-body textarea { width: 100%; padding: 10px 12px; margin-bottom: 12px; border: 1px solid #D4A373; border-radius: 8px; box-sizing: border-box; font-size: 0.9rem; }
        .modal-body .form-input:focus, .modal-body textarea:focus { outline: none; border-color: #E76F51; box-shadow: 0 0 0 2px rgba(231, 111, 81, 0.2); }
        .modal-body .form-button { background-color: #E76F51; color: white; padding: 10px 18px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: background-color 0.3s; width: 100%; font-size: 0.95rem; }
        .modal-body .form-button:hover { background-color: #D95A3F; }
        .modal-body .google-signin-btn { background-color: #4285F4; color: white; margin-top: 10px; }
        .modal-body .google-signin-btn:hover { background-color: #357AE8; }
        .modal-body .or-divider { text-align: center; margin: 15px 0; color: #8C7A6B; font-size: 0.85rem; position: relative; }
        .modal-body .or-divider::before, .modal-body .or-divider::after { content: ""; display: block; width: 40%; height: 1px; background-color: #D7CCC8; position: absolute; top: 50%; }
        .modal-body .or-divider::before { left: 0; } .modal-body .or-divider::after { right: 0; }
        .modal-body .switch-auth-link { text-align: center; margin-top: 15px; font-size: 0.85rem; }
        .modal-body .switch-auth-link a { color: #E76F51; text-decoration: none; font-weight: 500; }
        .modal-body .switch-auth-link a:hover { text-decoration: underline; }
        .error-message { color: #D32F2F; background-color: #FFCDD2; border: 1px solid #EF5350; padding: 8px; border-radius: 4px; font-size: 0.875rem; margin-bottom: 10px; text-align: center; }

        .swiper-pagination-bullet-active { background-color: #E76F51 !important; }
        .swiper-button-next, .swiper-button-prev { color: #E76F51 !important; --swiper-navigation-size: 28px; }
        .swiper-button-next:after, .swiper-button-prev:after { filter: drop-shadow(0 0 3px rgba(0,0,0,0.5)); }
        
        .svg-pattern-1 { width: 36px; height: 36px; fill: none; stroke: #795548; stroke-width:2; }
        .svg-pattern-2 { width: 36px; height: 36px; fill: #795548; }
        .svg-pattern-3 { width: 36px; height: 36px; fill: #E76F51; }

        /* Dashboard Styling */
        #dashboardPage { /* This is the container for the dashboard view */
            display: none; /* Initially hidden */
            flex-direction: column;
            align-items: center;
            padding: 20px;
            background-color: #F9F9F9;
            flex-grow: 1;
            width: 100%;
            overflow-y: auto; /* Allow dashboard to scroll if content overflows */
        }
        .dashboard-container {
            background-color: white; padding: 20px; border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1); width: 100%; max-width: 900px;
        }
        .dashboard-header { text-align: center; margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 15px; }
        .dashboard-header h2 { font-family: 'Playfair Display', serif; color: #4A3B31; font-size: 2rem; }
        .dashboard-section { margin-bottom: 25px; padding: 15px; background-color: #fff; border-radius: 8px; border: 1px solid #e0e0e0; }
        .dashboard-section h3 { font-size: 1.25rem; color: #E76F51; margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
        .dashboard-button {
            background-color: #4CAF50; color: white; padding: 10px 15px; border: none;
            border-radius: 6px; cursor: pointer; font-weight: 500; transition: background-color 0.3s;
            margin-right: 10px; margin-bottom: 10px;
        }
        .dashboard-button:hover { background-color: #45a049; }
        .dashboard-button-secondary { background-color: #007BFF; }
        .dashboard-button-secondary:hover { background-color: #0056b3; }

        #editProfileModal .modal-body label { display: block; margin-bottom: 0.5rem; color: #4A3B31; font-weight: 500; }
        #editProfileModal .modal-body input[type="checkbox"] { margin-right: 0.5rem; }
        #editProfileModal .modal-body .checkbox-group label { display: inline-block; margin-right: 1rem; font-weight: normal; }
        .hidden { display: none !important; }
        .flex-container { display: flex; flex-direction: column; min-height: 100vh; }
    </style>
</head>
<body class="flex-container">
    <div class="african-pattern-bg"></div>

    <header class="top-bar">
        <div class="logo" onclick="navigateToHome()">e<span class="highlight">K</span>haya</div>
        <div class="auth-buttons">
            <button class="login-btn" onclick="openModal('loginModal')">Login</button>
            <button onclick="openModal('registerModal')">Sign Up</button>
        </div>
    </header>

    <div class="main-content-area">
        <div class="homepage-content">
            <div class="hero-carousel-container">
                <div class="swiper-container">
                    <div class="swiper-wrapper">
                        <div class="swiper-slide" style="background-image: url('https://images.unsplash.com/photo-1569732008639-321900e97000?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Nnx8cnVyYWwlMjBzb3V0aCUyMGFmcmljYXxlbnwwfHwwfHx8MA%3D%3D&auto=format&fit=crop&w=1200&q=80');">
                            <div class="slide-content">
                                <h2>Embrace Rural Serenity</h2>
                                <p>Discover hidden gems in the heart of South Africa. eKhaya connects you to authentic rural stays and vibrant local communities.</p>
                                <div>
                                    <a href="#" class="cta-button" onclick="openModalWithContent('exploreModal', 'Rural South Africa', 'https://images.unsplash.com/photo-1603202662435-f5133c761416?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxzZWFyY2h8NXx8ZWFzdGVybiUyMGNhcGV8ZW58MHx8MHx8&auto=format&fit=crop&w=800&q=60')">Explore Stays</a>
                                    <a href="#" class="cta-button cta-button-secondary" onclick="openModalWithContent('showcaseModal', 'Your Community', 'https://images.unsplash.com/photo-1543269865-cbf427effbad?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxzZWFyY2h8Mnx8c291dGglMjBhZnJpY2FuJTIwdmlsbGFnZXxlbnwwfHwwfHw%3D&auto=format&fit=crop&w=800&q=60')">Showcase Your Area</a>
                                </div>
                            </div>
                        </div>
                        <div class="swiper-slide" style="background-image: url('https://images.unsplash.com/photo-1519019438191-c5904345e78a?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MTJ8fGFmcmljYW4lMjB2aWxsYWdlJTIwbGlmZXxlbnwwfHwwfHx8MA%3D%3D&auto=format&fit=crop&w=1200&q=80');">
                            <div class="slide-content">
                                <h2>The Spirit of Ubuntu</h2>
                                <p>eKhaya is built on community, fairness, and shared prosperity. Find your place, share your space, and grow together.</p>
                                 <div>
                                    <a href="#" class="cta-button" onclick="openModal('ourStoryModal')">Our Story</a>
                                    <a href="#" class="cta-button cta-button-secondary" onclick="openModal('resourceHubModal')">Empower Yourself</a>
                                </div>
                            </div>
                        </div>
                         <div class="swiper-slide" style="background-image: url('https://images.unsplash.com/photo-1586494053092-597990133996?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxzZWFyY2h8M3x8a3dhenVsdSUyMG5hdGFsfGVufDB8fDB8fA%3D%3D&auto=format&fit=crop&w=1200&q=60');">
                            <div class="slide-content">
                                <h2>KwaZulu-Natal's Charm</h2>
                                <p>From Drakensberg's majesty to coastal warmth, discover unique homes and welcoming Amamkeli (Hosts).</p>
                                 <div>
                                    <a href="#" class="cta-button" onclick="openModalWithContent('exploreModal', 'KwaZulu-Natal', 'https://images.unsplash.com/photo-1604973573749-0669f9370415?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxzZWFyY2h8MTB8fGt3YXp1bHUlMjBuYXRhbCUyMGxhbmRzY2FwZXxlbnwwfHwwfHw%3D&auto=format&fit=crop&w=800&q=60')">Explore KZN Stays</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="swiper-pagination"></div>
                    <div class="swiper-button-next"></div>
                    <div class="swiper-button-prev"></div>
                </div>
            </div>

            <div class="icon-hub">
                <div class="icon-grid">
                    <div class="icon-item" onclick="openModal('ourStoryModal')">
                        <i class="fas fa-heartbeat"></i>
                        <span>Our eKhaya Story</span>
                    </div>
                    <div class="icon-item" onclick="openModal('findHomeModal')">
                        <i class="fas fa-map-signs"></i>
                        <span>Find Your eKhaya</span>
                    </div>
                    <div class="icon-item" onclick="openModal('shareSpaceModal')">
                         <i class="fas fa-hands-helping"></i>
                        <span>Share Your Space</span>
                    </div>
                    <div class="icon-item" onclick="openModal('resourceHubModal')">
                        <i class="fas fa-book-open"></i>
                        <span>Knowledge Hub</span>
                    </div>
                    <div class="icon-item" onclick="openModal('whyEkhayaModal')"> <i class="fas fa-question-circle"></i>
                        <span>Why Choose eKhaya?</span>
                    </div>
                    <div class="icon-item" onclick="openModal('membershipPerksModal')"> <i class="fas fa-star"></i>
                        <span>Membership Perks</span>
                    </div>
                </div>
            </div>
        </div>

        <div id="dashboardPage" class="dashboard-page-container">
            <div class="dashboard-container">
                <div class="dashboard-header">
                    <h2>My eKhaya Dashboard</h2>
                    <p class="text-lg">Welcome, <span id="dashboardUserName" class="font-semibold">User</span>!</p>
                    <p class="text-sm text-gray-600">User ID: <span id="dashboardUserId" class="font-mono"></span></p>
                </div>

                <div class="dashboard-section">
                    <h3><i class="fas fa-user-circle mr-2"></i>Profile Management</h3>
                    <p class="text-gray-600 mb-3">Keep your information up-to-date to make the most of eKhaya. Your profile helps build trust within our community.</p>
                    <button class="dashboard-button bg-blue-500 hover:bg-blue-700 text-white" onclick="openModal('editProfileModal')">
                        <i class="fas fa-user-edit mr-2"></i>Edit My Profile
                    </button>
                </div>

                <div class="dashboard-section">
                    <h3><i class="fas fa-id-badge mr-2"></i>My Roles on eKhaya</h3>
                    <p class="text-gray-600 mb-3">Your current roles determine the tools and features available to you. You can update these in your profile.</p>
                    <div id="currentRolesDisplay" class="mb-3 p-3 bg-blue-50 border-l-4 border-blue-500 text-blue-700 rounded-md">
                        Loading roles...
                    </div>
                </div>

                <div id="landlordDashboardSection" class="dashboard-section hidden">
                    <h3><i class="fas fa-house-user mr-2"></i>Landlord Space</h3>
                    <p class="text-gray-600 mb-3">Manage your properties, connect with Abahlali (Tenants) & Bandwendwe (Guests), and access landlord-specific resources.</p>
                    <button class="dashboard-button bg-green-500 hover:bg-green-700" onclick="openModal('addPropertyModal')">
                        <i class="fas fa-plus-circle mr-2"></i>List a New Property
                    </button>
                    <button class="dashboard-button bg-green-500 hover:bg-green-700 mt-2 md:mt-0">
                        <i class="fas fa-list-alt mr-2"></i>View My Listings (Coming Soon)
                    </button>
                    <button class="dashboard-button bg-green-500 hover:bg-green-700 mt-2 md:mt-0">
                        <i class="fas fa-comments mr-2"></i>My Messages (Coming Soon)
                    </button>
                </div>

                <div id="tenantDashboardSection" class="dashboard-section hidden">
                    <h3><i class="fas fa-key mr-2"></i>Tenant Space</h3>
                    <p class="text-gray-600 mb-3">Find your next home, manage your rental applications, and communicate with Abanikazi Beendawo (Landlords).</p>
                    <button class="dashboard-button bg-indigo-500 hover:bg-indigo-700" onclick="openModal('searchPropertiesModal')">
                        <i class="fas fa-search mr-2"></i>Search for Properties (Coming Soon)
                    </button>
                    <button class="dashboard-button bg-indigo-500 hover:bg-indigo-700 mt-2 md:mt-0">
                        <i class="fas fa-heart mr-2"></i>My Saved Properties (Coming Soon)
                    </button>
                     <button class="dashboard-button bg-indigo-500 hover:bg-indigo-700 mt-2 md:mt-0">
                        <i class="fas fa-file-alt mr-2"></i>My Applications (Coming Soon)
                    </button>
                </div>
                 <button class="dashboard-button bg-gray-700 hover:bg-gray-800 mt-6 w-full md:w-auto" onclick="navigateToHome()">
                    <i class="fas fa-arrow-left mr-2"></i>Back to Homepage
                </button>
            </div>
        </div>
    </div> <div id="registerModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal('registerModal')">&times;</span>
            <h3 class="modal-title">Join the eKhaya Community</h3>
            <div class="modal-body">
                <p>Create your account to unlock a world of resources, connect with others, and find or share your perfect space.</p>
                <div id="registerError" class="error-message" style="display:none;"></div>
                <form id="registerForm">
                    <input type="text" id="registerName" placeholder="Full Name" class="form-input" required>
                    <input type="email" id="registerEmail" placeholder="Email Address" class="form-input" required>
                    <input type="password" id="registerPassword" placeholder="Password (min. 6 characters)" class="form-input" required>
                    <input type="password" id="registerConfirmPassword" placeholder="Confirm Password" class="form-input" required>
                    <button type="submit" class="form-button">Register with Email</button>
                </form>
                <div class="or-divider">OR</div>
                <button class="form-button google-signin-btn" onclick="handleGoogleSignUp()">
                    <i class="fab fa-google mr-2"></i> Sign Up with Google
                </button>
                <p class="switch-auth-link mt-4">Already have an account? <a href="#" onclick="switchToLogin()">Log In</a></p>
            </div>
        </div>
    </div>

    <div id="loginModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal('loginModal')">&times;</span>
            <h3 class="modal-title">Welcome Back to eKhaya!</h3>
            <div class="modal-body">
                <p>Log in to access your dashboard, manage your profile, and continue your eKhaya journey.</p>
                <div id="loginError" class="error-message" style="display:none;"></div>
                <form id="loginForm">
                    <input type="email" id="loginEmail" placeholder="Email Address" class="form-input" required>
                    <input type="password" id="loginPassword" placeholder="Password" class="form-input" required>
                    <button type="submit" class="form-button">Log In with Email</button>
                </form>
                <div class="or-divider">OR</div>
                <button class="form-button google-signin-btn" onclick="handleGoogleSignIn()">
                    <i class="fab fa-google mr-2"></i> Sign In with Google
                </button>
                <p class="switch-auth-link mt-4">Don't have an account? <a href="#" onclick="switchToRegister()">Create Account</a></p>
            </div>
        </div>
    </div>
    
    <div id="editProfileModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal('editProfileModal')">&times;</span>
            <h3 class="modal-title">Complete & Update Your Profile</h3>
            <div class="modal-body">
                <p class="text-sm text-gray-600 mb-4">The more complete your profile, the better eKhaya can serve you and build trust within the community.</p>
                <div id="profileUpdateError" class="error-message" style="display:none;"></div>
                <form id="profileUpdateForm">
                    <div class="mb-4">
                        <label for="profileDisplayName" class="block text-gray-700 text-sm font-bold mb-1">Display Name:</label>
                        <input type="text" id="profileDisplayName" class="form-input" placeholder="Your Name">
                    </div>
                    <div class="mb-4">
                        <label for="profilePhoneNumber" class="block text-gray-700 text-sm font-bold mb-1">Phone Number (Optional):</label>
                        <input type="tel" id="profilePhoneNumber" class="form-input" placeholder="e.g., 0821234567">
                    </div>
                    <div class="mb-4">
                        <label for="profileBio" class="block text-gray-700 text-sm font-bold mb-1">Short Bio (Optional):</label>
                        <textarea id="profileBio" class="form-input" rows="3" placeholder="Tell us a bit about yourself, your interests, or what you're looking for..."></textarea>
                    </div>
                     <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">How will you primarily use eKhaya?</label>
                        <div class="checkbox-group flex items-center mb-2">
                            <input type="checkbox" id="roleTenant" name="userRole" value="tenant" class="mr-2 h-5 w-5 text-orange-600 border-gray-300 rounded focus:ring-orange-500">
                            <label for="roleTenant" class="text-gray-700">As a Tenant / Umhlali (Looking for a place)</label>
                        </div>
                        <div class="checkbox-group flex items-center">
                            <input type="checkbox" id="roleLandlord" name="userRole" value="landlord" class="mr-2 h-5 w-5 text-orange-600 border-gray-300 rounded focus:ring-orange-500">
                            <label for="roleLandlord" class="text-gray-700">As a Landlord / Umamkeli (Sharing a space)</label>
                        </div>
                    </div>

                    <div id="landlordSpecificFields" class="hidden mt-4 border-t pt-4">
                        <h4 class="text-md font-semibold text-gray-700 mb-2">Landlord / Umamkeli Details:</h4>
                        <div class="mb-3">
                            <label for="landlordPropertiesCount" class="block text-gray-700 text-sm font-bold mb-1">Number of Properties/Units/Rooms you manage:</label>
                            <input type="number" id="landlordPropertiesCount" class="form-input" min="0" placeholder="e.g., 1">
                        </div>
                        <div class="mb-3">
                            <label for="landlordExperienceYears" class="block text-gray-700 text-sm font-bold mb-1">Years of experience as a Landlord/Umamkeli:</label>
                            <input type="number" id="landlordExperienceYears" class="form-input" min="0" placeholder="e.g., 5">
                        </div>
                         <div class="mb-3">
                            <label for="landlordHostingStyle" class="block text-gray-700 text-sm font-bold mb-1">Describe your hosting/landlord style (Optional):</label>
                            <textarea id="landlordHostingStyle" class="form-input" rows="2" placeholder="e.g., Friendly and hands-on, respectful of privacy..."></textarea>
                        </div>
                    </div>

                    <div id="tenantSpecificFields" class="hidden mt-4 border-t pt-4">
                        <h4 class="text-md font-semibold text-gray-700 mb-2">Tenant / Umhlali Details:</h4>
                        <div class="mb-3">
                            <label for="tenantLookingFor" class="block text-gray-700 text-sm font-bold mb-1">Type of place you're looking for:</label>
                            <select id="tenantLookingFor" class="form-input">
                                <option value="">Select type</option>
                                <option value="room">Room</option>
                                <option value="cottage">Cottage / Back Room</option>
                                <option value="flat">Flat / Apartment</option>
                                <option value="house">House</option>
                                <option value="rondavel">Traditional Home / Rondavel</option>
                                <option value="farm_stay">Farm Stay</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="tenantBedrooms" class="block text-gray-700 text-sm font-bold mb-1">Preferred number of bedrooms:</label>
                            <input type="number" id="tenantBedrooms" class="form-input" min="0" placeholder="e.g., 1">
                        </div>
                        <div class="mb-3">
                            <label for="tenantIdealSituation" class="block text-gray-700 text-sm font-bold mb-1">Describe your ideal rental situation (Optional):</label>
                            <textarea id="tenantIdealSituation" class="form-input" rows="2" placeholder="e.g., Quiet, close to transport, pet-friendly..."></textarea>
                        </div>
                    </div>
                    <p class="text-xs text-gray-500 mt-3 mb-3">You can always update these details later. Your privacy is important to us; you'll control what's shared.</p>
                    <button type="submit" class="form-button">Save Profile Changes</button>
                </form>
            </div>
        </div>
    </div>

    <div id="infoModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal('infoModal')">&times;</span>
            <h3 id="infoModalTitle" class="modal-title">Notification</h3>
            <div id="infoModalBody" class="modal-body text-center">
                </div>
        </div>
    </div>

    <div id="ourStoryModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal('ourStoryModal')">&times;</span>
            <h3 class="modal-title"><i class="fas fa-heartbeat mr-2 text-red-500"></i>Our eKhaya Story: Rooted in Ubuntu</h3>
            <img src="https://images.unsplash.com/photo-1531300900929-673afa703570?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Nnx8YWZyaWNhbiUyMGNvbW11bml0eXxlbnwwfHwwfHx8MA%3D%3D&auto=format&fit=crop&w=500&q=60" alt="Hands together in community" class="mx-auto mb-4 rounded-lg shadow-lg">
            <p>eKhaya, meaning "home" in isiXhosa and isiZulu, is more than just a platform â€“ it's a heartfelt mission. We are inspired by the timeless African philosophy of **Ubuntu**: "Umntu ngumntu ngabantu" â€“ I am because you are. This spirit of interconnectedness, community, and shared humanity is the bedrock of eKhaya.</p>
            <p>In many of our vibrant South African communities, especially in rural areas, the tradition of welcoming a stranger (undwendwe) with an open heart, offering shelter and sustenance without expecting immediate payment, is a cherished value. Itâ€™s about paying it forward, knowing that one day you might be the traveller in need.</p>
            <h4>Our Vision:</h4>
            <p>We aim to bring this profound spirit of generosity and mutual respect into the digital age. eKhaya seeks to:</p>
            <ul>
                <li><i class="fas fa-users mr-2 text-green-500"></i> **Empower** individuals in rural and informal settlements by providing them with the tools and knowledge to safely and effectively share their spaces.</li>
                <li><i class="fas fa-handshake mr-2 text-blue-500"></i> **Connect** Abahlali (tenants) and Abamkeli (hosts/landlords) in a way that fosters understanding, fairness, and trust.</li>
                <li><i class="fas fa-leaf mr-2 text-teal-500"></i> **Showcase** the often-overlooked beauty, culture, and hospitality of South Africa's diverse heartlands, creating new opportunities for local economies.</li>
                <li><i class="fas fa-balance-scale mr-2 text-purple-500"></i> **Simplify** the rental process with accessible resources, clear guidance, and user-friendly technology.</li>
            </ul>
            <p>eKhaya is about building bridges, strengthening communities, and ensuring that the search for a home, or the decision to share one, is a positive and dignified experience for everyone. Join us in cultivating a rental ecosystem where everyone feels valued and at home.</p>
        </div>
    </div>

    <div id="findHomeModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal('findHomeModal')">&times;</span>
            <h3 class="modal-title"><i class="fas fa-map-signs mr-2 text-blue-500"></i>Find Your eKhaya: A Place to Belong</h3>
            <img src="https://images.unsplash.com/photo-1556955112-28cde3817b0a?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MTF8fHJ1cmFsJTIwaG9tZSUyMHNvdXRoJTIwYWZyaWNhfGVufDB8fDB8fHww&auto=format&fit=crop&w=500&q=60" alt="Peaceful rural home" class="mx-auto mb-4 rounded-lg shadow-lg">
            <p>Are you searching for your next home, a tranquil rural retreat, or a unique short-term stay? eKhaya is your gateway to discovering diverse properties across South Africa, with a special heart for the authentic charm of our countryside and small towns.</p>
            <h4>What You Can Expect:</h4>
            <ul>
                <li><i class="fas fa-search-location mr-2 text-green-500"></i> **Tailored Search (Coming Soon):** Our intuitive search tools will help you find listings that match your needs â€“ from a cozy room in a vibrant township to a spacious farmhouse surrounded by nature.</li>
                <li><i class="fas fa-home mr-2 text-orange-500"></i> **Focus on Authenticity:** We champion listings that offer a genuine taste of South African life, especially in less-explored rural areas.</li>
                <li><i class="fas fa-shield-alt mr-2 text-purple-500"></i> **Informed Choices:** Access clear information about properties and connect with Abamkeli (hosts/landlords) who are part of our community.</li>
                <li><i class="fas fa-users mr-2 text-teal-500"></i> **Community Connection:** Find more than just a place to stay; find a community where you feel you belong.</li>
            </ul>
            <p>Whether you're an Umhlali (tenant) looking for a long-term haven or an Undwendwe (traveller) seeking a memorable experience, your journey to finding the perfect eKhaya starts here. Our full search and booking features are under development and will be launching soon!</p>
        </div>
    </div>
    
    <div id="shareSpaceModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal('shareSpaceModal')">&times;</span>
            <h3 class="modal-title"><i class="fas fa-hands-helping mr-2 text-green-500"></i>Share Your Space: Welcome Others to Your eKhaya</h3>
            <img src="https://images.unsplash.com/photo-1600047509807-ba8f99d2cdde?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Mnx8c291dGglMjBhZnJpY2FuJTIwaG9tZXxlbnwwfHwwfHx8MA%3D%3D&auto=format&fit=crop&w=500&q=60" alt="A welcoming South African home" class="mx-auto mb-4 rounded-lg shadow-lg">
            <p>Do you have an extra room, a charming garden cottage, a traditional rondavel, or a unique space in your rural homestead or town? eKhaya empowers you to share your space with Abahlali (tenants) and Bandwendwe (travellers) seeking authentic South African experiences.</p>
            <h4>Why Share Your Space with eKhaya?</h4>
            <ul>
                <li><i class="fas fa-bullhorn mr-2 text-orange-500"></i> **Reach a Wider Audience:** Connect with individuals actively looking for spaces like yours, especially those interested in rural and unique stays.</li>
                <li><i class="fas fa-tools mr-2 text-blue-500"></i> **Simple Listing Tools (Coming Soon):** We're building easy-to-use tools to help you create attractive listings, manage inquiries, and handle bookings with confidence.</li>
                <li><i class="fas fa-shield-alt mr-2 text-purple-500"></i> **Support & Resources:** Access our Knowledge Hub for guidance on being a great Umamkeli (host/landlord), understanding your rights, and navigating the rental process.</li>
                <li><i class="fas fa-coins mr-2 text-green-500"></i> **Economic Empowerment:** Generate income from your property while contributing to your local community's growth.</li>
            </ul>
            <p>Become an Umamkeli on eKhaya and open your doors to respectful individuals. We're here to support you in creating positive and rewarding hosting experiences. Our full listing and management tools are coming soon!</p>
        </div>
    </div>

    <div id="resourceHubModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal('resourceHubModal')">&times;</span>
            <h3 class="modal-title"><i class="fas fa-book-open mr-2 text-purple-500"></i>eKhaya Knowledge Hub</h3>
            <p class="text-center mb-6">Knowledge is power. Our comprehensive Resource Hub is designed to empower landlords, tenants, and guests with essential information, practical tools, and clear guidance for a smoother, fairer, and more informed rental journey in South Africa.</p>
            
            <h4><i class="fas fa-balance-scale text-orange-500 mr-2"></i>Legal Ease & Your Rights</h4>
            <p>Navigate the legal landscape with confidence. We simplify complex regulations:</p>
            <ul>
                <li>Understanding the Rental Housing Act (RHA) and its implications.</li>
                <li>Tenant rights: deposits, privacy, maintenance, fair eviction processes.</li>
                <li>Landlord rights: property access, managing breaches, recovering damages.</li>
                <li>Lease agreements explained: key clauses, what to look for, sample templates.</li>
                <li>Dispute resolution: understanding the Rental Housing Tribunal (RHT) process.</li>
                <li>Understanding the Prevention of Illegal Eviction Act (PIE).</li>
            </ul>

            <h4><i class="fas fa-piggy-bank text-green-500 mr-2"></i>Financial Fitness & Management</h4>
            <p>Manage your rental finances effectively, whether you're a tenant or landlord:</p>
            <ul>
                <li>Tenant budgeting: affording rent, managing utilities, saving for a deposit.</li>
                <li>Landlord finances: setting fair rent, managing rental income, understanding tax implications (basic overview), and budgeting for maintenance.</li>
                <li>Understanding and managing deposits correctly.</li>
                <li>Tips for avoiding rental scams.</li>
            </ul>

            <h4><i class="fas fa-tools text-blue-500 mr-2"></i>Happy Homes & Property Care</h4>
            <p>Creating and maintaining a positive living environment:</p>
            <ul>
                <li>Tenant responsibilities for property care.</li>
                <li>Landlord responsibilities for maintenance and repairs.</li>
                <li>Move-in and move-out inspection checklists and best practices.</li>
                <li>Tips for creating a welcoming and safe home environment.</li>
                <li>Understanding wear and tear vs. damages.</li>
            </ul>

            <h4><i class="fas fa-users-cog text-teal-500 mr-2"></i>Ubuntu Connect: Building Positive Relationships</h4>
            <p>Fostering understanding and respect in the rental space:</p>
            <ul>
                <li>Effective communication strategies for landlords and tenants.</li>
                <li>Conflict resolution tips and mediation basics.
                <li>Understanding cultural nuances in property interactions.</li>
                <li>Building a respectful landlord-tenant/host-guest relationship.</li>
                <li>Community guidelines and expectations on eKhaya.</li>
            </ul>
            <p class="text-center mt-6 text-sm text-gray-500">Our Knowledge Hub is constantly growing. We are committed to providing you with the most relevant and up-to-date information. Registered members may get access to more in-depth guides and tools!</p>
        </div>
    </div>
    
    <div id="whyEkhayaModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal('whyEkhayaModal')">&times;</span>
            <h3 class="modal-title"><i class="fas fa-question-circle mr-2 text-orange-500"></i>Why Choose eKhaya?</h3>
            <img src="https://images.unsplash.com/photo-1542344807-c868300ba913?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Nnx8c291dGglMjBhZnJpY2FuJTIwY29tbXVuaXR5JTIwaGVscGluZ3xlbnwwfHwwfHx8MA%3D%3D&auto=format&fit=crop&w=500&q=60" alt="People collaborating in a community" class="mx-auto mb-4 rounded-lg shadow-lg">
            <p>eKhaya is more than just a listing site; we're building a community founded on the principles of **Ubuntu**, fairness, and mutual respect. We believe in empowering every South African involved in the rental journey.</p>
            <h4>Our Commitment to You:</h4>
            <ul>
                <li><i class="fas fa-users text-green-500 mr-2"></i> **Focus on People, Not Just Property:** We understand the human element in renting and aim to foster positive relationships between Abamkeli (Landlords/Hosts) and Abahlali/Bandwendwe (Tenants/Guests).</li>
                <li><i class="fas fa-map-marker-alt text-blue-500 mr-2"></i> **Championing Rural & Informal Sectors:** We shine a light on often-overlooked areas, creating opportunities for economic growth and showcasing the unique beauty of all corners of South Africa.</li>
                <li><i class="fas fa-book text-purple-500 mr-2"></i> **Comprehensive & Free Resources:** Our Knowledge Hub provides accessible information on legal rights, financial management, and property care, empowering you to make informed decisions.</li>
                <li><i class="fas fa-shield-alt text-red-500 mr-2"></i> **Building Trust & Safety:** Through transparent profiles (with user consent), clear communication tools, and future rating systems, we aim to create a more secure rental environment.</li>
                <li><i class="fas fa-hands-helping text-yellow-500 mr-2"></i> **Simplicity & Accessibility:** We're designing eKhaya to be easy to use for everyone, regardless of technical expertise.</li>
            </ul>
            <p>Whether you're looking for a home, sharing your space, or seeking reliable information, eKhaya is here to support you every step of the way. Join us in creating a better rental experience for all South Africans.</p>
        </div>
    </div>

    <div id="membershipPerksModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal('membershipPerksModal')">&times;</span>
            <h3 class="modal-title"><i class="fas fa-star mr-2 text-yellow-400"></i>eKhaya Membership Perks</h3>
            <p class="text-center mb-6">Discover the benefits of joining and growing with the eKhaya community.</p>

            <div class="mb-6 p-4 border rounded-lg bg-gray-50">
                <h4 class="font-semibold text-lg text-gray-700 mb-2"><i class="fas fa-eye mr-2 text-gray-500"></i>As a Guest (Unregistered User)</h4>
                <ul class="list-disc list-inside text-sm text-gray-600 space-y-1">
                    <li>Access to our comprehensive Knowledge Hub: Read articles, guides, and FAQs.</li>
                    <li>View publicly showcased properties and regional highlights.</li>
                    <li>Get a feel for the eKhaya community and values.</li>
                </ul>
            </div>

            <div class="mb-6 p-4 border rounded-lg bg-blue-50">
                <h4 class="font-semibold text-lg text-blue-700 mb-2"><i class="fas fa-user-plus mr-2"></i>As a Registered Member (Free)</h4>
                <ul class="list-disc list-inside text-sm text-blue-600 space-y-1">
                    <li>All Guest benefits, PLUS:</li>
                    <li>Create your eKhaya Profile (Tenant, Landlord/Umamkeli, or both).</li>
                    <li>**Landlords/Abamkeli:** List one property for free to showcase your space (with options for public, members-only, or private visibility).</li>
                    <li>**Tenants/Abahlali:** Create a basic tenant profile to share with potential landlords (with your consent).</li>
                    <li>Save property searches and favorite listings (coming soon).</li>
                    <li>Basic in-platform communication with other members (coming soon).</li>
                    <li>Access to additional member-only resources and templates.</li>
                    <li>Receive community updates and newsletters.</li>
                    <li>*First 30 days: Enjoy a trial of all Subscriber features!*</li>
                </ul>
            </div>

            <div class="p-4 border rounded-lg bg-orange-50">
                <h4 class="font-semibold text-lg text-orange-700 mb-2"><i class="fas fa-crown mr-2"></i>As a Subscriber (Premium - Coming Soon!)</h4>
                <ul class="list-disc list-inside text-sm text-orange-600 space-y-1">
                    <li>All Registered Member benefits, PLUS:</li>
                    <li>**Landlords/Abamkeli:** List multiple properties, enhanced listing visibility, access to advanced property management tools (e.g., lease generation, basic invoicing).</li>
                    <li>**Tenants/Abahlali:** Advanced search filters, priority notifications for new matching listings, enhanced profile features to stand out.</li>
                    <li>Detailed rating and review system access (viewing and contributing).</li>
                    <li>Advanced communication tools and document sharing.
                    <li>Access to exclusive premium content in the Knowledge Hub.</li>
                    <li>Priority support.</li>
                    <li>And much more as we grow!</li>
                </ul>
                <p class="text-xs text-orange-700 mt-2">Subscription plans and pricing will be announced closer to the launch of premium features. We are committed to keeping core services accessible.</p>
            </div>
             <p class="text-center mt-6 text-sm text-gray-500">eKhaya is committed to growing with our community. We value your participation and feedback!</p>
        </div>
    </div>

    <div id="testimonialsModal" class="modal hidden">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal('testimonialsModal')">&times;</span>
            <h3 class="modal-title">Voices from Our eKhaya</h3>
            <p class="text-center mb-6">Real stories from our growing community:</p>
            </div>
    </div>
    
    <div id="genericContentModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal('genericContentModal')">&times;</span>
            <h3 id="genericModalTitle" class="modal-title">Dynamic Title</h3>
            <div id="genericModalBody" class="modal-body">
                </div>
        </div>
    </div>

    <div id="addPropertyModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal('addPropertyModal')">&times;</span>
            <h3 class="modal-title">List Your Property/Space</h3>
            <div class="modal-body">
                <p>Showcase your eKhaya to potential Abahlali (Tenants) or Bandwendwe (Guests)! Provide as much detail as possible.</p>
                <form id="addPropertyForm">
                    <div class="mb-4">
                        <label for="propertyTitle" class="block text-gray-700 text-sm font-bold mb-1">Property Title (e.g., "Cozy 2-Bedroom Cottage with Garden")</label>
                        <input type="text" id="propertyTitle" class="form-input" required>
                    </div>
                    <div class="mb-4">
                        <label for="propertyDescription" class="block text-gray-700 text-sm font-bold mb-1">Description</label>
                        <textarea id="propertyDescription" class="form-input" rows="4" placeholder="Describe your property, its unique features, and the surrounding area."></textarea>
                    </div>
                     <div class="mb-4">
                        <label for="propertyType" class="block text-gray-700 text-sm font-bold mb-1">Property Type</label>
                        <select id="propertyType" class="form-input">
                            <option value="room_in_house">Room in a House</option>
                            <option value="backyard_room">Backyard Room/Cottage</option>
                            <option value="flat_apartment">Flat/Apartment</option>
                            <option value="house_full">Full House</option>
                            <option value="rondavel_traditional">Rondavel/Traditional Home</option>
                            <option value="farm_stay">Farm Stay</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <p class="text-center text-gray-600 my-4">More fields for address, amenities, photos, price, etc., will be added here.</p>
                    <button type="submit" class="form-button mt-4">Save Property & Create Listing (Coming Soon)</button>
                </form>
            </div>
        </div>
    </div>

    <div id="searchPropertiesModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal('searchPropertiesModal')">&times;</span>
            <h3 class="modal-title">Find Your Ideal eKhaya</h3>
            <div class="modal-body">
                <p>Our comprehensive search is coming soon! You'll be able to filter by location, price, property type, amenities, and more.</p>
                <img src="https://images.unsplash.com/photo-1502672260266-1c1ef2d93688?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MTJ8fGFwYXJ0bWVudCUyMHNlYXJjaHxlbnwwfHwwfHx8MA%3D%3D&auto=format&fit=crop&w=500&q=60" alt="Searching for a home" class="mx-auto my-4 rounded-lg shadow-md">
                <p>For now, browse our showcased regions and imagine the possibilities!</p>
                 <button class="form-button mt-4" onclick="closeModal('searchPropertiesModal')">Got it!</button>
            </div>
        </div>
    </div>


    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-analytics.js";
        import { 
            getAuth, 
            GoogleAuthProvider, 
            signInWithPopup, 
            createUserWithEmailAndPassword, 
            signInWithEmailAndPassword, 
            signOut, 
            onAuthStateChanged,
            updateProfile as firebaseUpdateProfile 
        } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js";
        import { 
            getFirestore, 
            doc, 
            setDoc, 
            getDoc,
            updateDoc, 
            serverTimestamp 
        } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "YOUR_API_KEY", //  REPLACE WITH YOUR ACTUAL API KEY
            authDomain: "ekhaya-b6fdd.firebaseapp.com",
            projectId: "ekhaya-b6fdd",
            storageBucket: "ekhaya-b6fdd.appspot.com",
            messagingSenderId: "242813323857",
            appId: "1:242813323857:web:3cb499210790b034610670",
            measurementId: "G-4JK8WEQCY7"
        };

        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const googleProvider = new GoogleAuthProvider();

        let currentAuthUser = null; 
        let userProfileData = null; 

        const authButtonsContainer = document.querySelector('.auth-buttons');
        const profileUserNameEl = document.getElementById('profileUserName');
        const profileUserEmailEl = document.getElementById('profileUserEmail');
        const profileUserIdEl = document.getElementById('profileUserId');
        
        const dashboardPage = document.getElementById('dashboardPage');
        const homepageContent = document.querySelector('.homepage-content'); 
        const dashboardUserNameEl = document.getElementById('dashboardUserName');
        const dashboardUserIdEl = document.getElementById('dashboardUserId');
        const landlordDashboardSection = document.getElementById('landlordDashboardSection');
        const tenantDashboardSection = document.getElementById('tenantDashboardSection');
        const currentRolesDisplay = document.getElementById('currentRolesDisplay');
        const landlordSpecificFieldsDiv = document.getElementById('landlordSpecificFields');
        const tenantSpecificFieldsDiv = document.getElementById('tenantSpecificFields');
        const roleTenantCheckbox = document.getElementById('roleTenant');
        const roleLandlordCheckbox = document.getElementById('roleLandlord');


        window.openModal = function(modalId) {
            document.querySelectorAll('.modal').forEach(m => m.style.display = 'none');
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = "flex";
                const errorDivs = modal.querySelectorAll('.error-message');
                errorDivs.forEach(div => {
                    div.style.display = 'none';
                    div.textContent = '';
                });
                if (modalId === 'editProfileModal' && currentAuthUser) {
                    populateProfileForm();
                }
            }
        }

        window.closeModal = function(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = "none";
            }
        }

        window.showInfoModal = function(title, message, isError = false) {
            const modalTitle = document.getElementById('infoModalTitle');
            const modalBody = document.getElementById('infoModalBody');
            modalTitle.textContent = title;
            modalBody.innerHTML = `<p class="${isError ? 'text-red-600 font-semibold' : 'text-green-600 font-semibold'}">${message}</p>
                                   <button class="form-button mt-4" onclick="closeModal('infoModal')">OK</button>`;
            openModal('infoModal');
        }
        
        window.openModalWithContent = function(modalType, topic, imageUrl) {
            const modal = document.getElementById('genericContentModal');
            const titleEl = document.getElementById('genericModalTitle');
            const bodyEl = document.getElementById('genericModalBody');
            let title = '';
            let bodyContent = '';

            if (modalType === 'exploreModal') {
                title = `Explore Beautiful ${topic}`;
                bodyContent = `
                    <img src="${imageUrl || 'https://placehold.co/550x300/777/FFF?text=Exploring...'}" alt="Explore ${topic}" class="mx-auto mb-4 rounded-lg shadow-md">
                    <p>Dive into the unique charm of ${topic}. Discover breathtaking landscapes, rich culture, and warm hospitality.</p>
                    <p>Our platform will soon feature detailed listings and travel guides for ${topic}. Imagine finding your perfect rural retreat or authentic homestay here!</p>
                    <button class="mt-4 bg-orange-500 hover:bg-orange-600 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline w-full" onclick="closeModal('genericContentModal')">Explore Listings (Coming Soon)</button>
                `;
            } else if (modalType === 'showcaseModal') {
                title = `Help Us Showcase ${topic}`;
                 bodyContent = `
                    <img src="${imageUrl || 'https://placehold.co/550x300/888/FFF?text=Showcasing...'}" alt="Showcase ${topic}" class="mx-auto mb-4 rounded-lg shadow-md">
                    <p>Do you have stories, photos, or insights about ${topic} that the world should know? We invite you to contribute to our community showcase!</p>
                    <p>Share what makes your village, town, or region special â€“ from hidden gems, local traditions, to community projects and natural wonders. Let's celebrate the diversity of South Africa together.</p>
                    <button class="mt-4 bg-orange-500 hover:bg-orange-600 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline w-full" onclick="closeModal('genericContentModal')">Contribute (Coming Soon)</button>
                `;
            }

            titleEl.textContent = title;
            bodyEl.innerHTML = bodyContent;
            openModal('genericContentModal');
        }

        window.onclick = function(event) {
            const modals = document.getElementsByClassName('modal');
            for (let i = 0; i < modals.length; i++) {
                if (event.target == modals[i]) {
                    modals[i].style.display = "none";
                }
            }
        }

        async function updateAuthUI(user) {
            if (user) {
                currentAuthUser = user; 
                await fetchUserProfile(user.uid); 

                authButtonsContainer.innerHTML = \`
                    <span class="text-sm mr-3 text-white">Hi, ${userProfileData?.displayName || user.displayName || user.email.split('@')[0]}!</span>
                    <button onclick="navigateToDashboard()" class="login-btn">Dashboard</button>
                    <button onclick="handleLogout()">Log Out</button>
                \`;
                if (profileUserNameEl) profileUserNameEl.textContent = userProfileData?.displayName || user.displayName || user.email;
                if (profileUserEmailEl) profileUserEmailEl.textContent = user.email;
                if (profileUserIdEl) profileUserIdEl.textContent = user.uid;
                
                if (dashboardUserNameEl) dashboardUserNameEl.textContent = userProfileData?.displayName || user.displayName || user.email;
                if (dashboardUserIdEl) dashboardUserIdEl.textContent = user.uid;
                
                updateDashboardBasedOnRole();

            } else {
                currentAuthUser = null;
                userProfileData = null;
                authButtonsContainer.innerHTML = \`
                    <button class="login-btn" onclick="openModal('loginModal')">Login</button>
                    <button onclick="openModal('registerModal')">Sign Up</button>
                \`;
                if (dashboardPage) dashboardPage.style.display = 'none';
                if (homepageContent) homepageContent.style.display = 'flex'; 
            }
        }
        
        async function fetchUserProfile(uid) {
            if (!uid) return;
            try {
                const userDocRef = doc(db, "users", uid);
                const docSnap = await getDoc(userDocRef);
                if (docSnap.exists()) {
                    userProfileData = docSnap.data();
                    console.log("User profile data fetched:", userProfileData);
                } else {
                    console.log("No such user document for UID:", uid, "Creating a default one.");
                    // If user is authenticated but no Firestore doc, create one (e.g., after Google sign-in if it's their first time)
                    const authUser = auth.currentUser;
                    if (authUser) {
                        const defaultProfile = {
                            uid: authUser.uid,
                            displayName: authUser.displayName || authUser.email.split('@')[0],
                            email: authUser.email,
                            photoURL: authUser.photoURL || null,
                            createdAt: serverTimestamp(),
                            roles: ["guest"] // Default role, user should update
                        };
                        await setDoc(userDocRef, defaultProfile);
                        userProfileData = defaultProfile;
                    } else {
                         userProfileData = null; // Should not happen if uid is present
                    }
                }
            } catch (error) {
                console.error("Error fetching user profile:", error);
                if(auth.currentUser) {
                    userProfileData = { 
                        displayName: auth.currentUser.displayName, 
                        email: auth.currentUser.email, 
                        uid: uid, 
                        roles: ['guest'] 
                    };
                } else {
                    userProfileData = null;
                }
            }
        }

        function updateDashboardBasedOnRole() {
            if (!userProfileData || !dashboardPage || dashboardPage.style.display === 'none') { 
                if (currentRolesDisplay) currentRolesDisplay.textContent = "Roles: Not available";
                if (landlordDashboardSection) landlordDashboardSection.classList.add('hidden');
                if (tenantDashboardSection) tenantDashboardSection.classList.add('hidden');
                return;
            }

            const roles = userProfileData.roles || ['guest']; 
            if (currentRolesDisplay) currentRolesDisplay.textContent = \`Current Roles: \${roles.map(r => r.charAt(0).toUpperCase() + r.slice(1)).join(', ')}\`;

            if (roles.includes('landlord')) {
                if (landlordDashboardSection) landlordDashboardSection.classList.remove('hidden');
            } else {
                if (landlordDashboardSection) landlordDashboardSection.classList.add('hidden');
            }

            if (roles.includes('tenant')) {
                if (tenantDashboardSection) tenantDashboardSection.classList.remove('hidden');
            } else {
                if (tenantDashboardSection) tenantDashboardSection.classList.add('hidden');
            }
        }
        
        window.navigateToDashboard = async () => {
            if (!currentAuthUser) {
                openModal('loginModal'); 
                return;
            }
            if (homepageContent) homepageContent.style.display = 'none'; 
            if (dashboardPage) dashboardPage.style.display = 'flex'; 
            
            closeModal('profileModal'); 
            
            await fetchUserProfile(currentAuthUser.uid); 
            updateDashboardBasedOnRole();
        }

        window.navigateToHome = function() {
            if (dashboardPage) dashboardPage.style.display = 'none';
            if (homepageContent) homepageContent.style.display = 'flex';
        }
        // Add event listener to logo for navigating home
        document.querySelector('.logo').addEventListener('click', navigateToHome);


        onAuthStateChanged(auth, async (user) => {
            if (user) {
                await updateAuthUI(user); 
                // Check if user is on homepage and should be redirected to dashboard
                // This logic can be tricky if user explicitly navigates home while logged in.
                // For now, we allow them to be on homepage while logged in.
                // navigateToDashboard(); // Uncomment if you want auto-redirect on login/refresh
            } else {
                updateAuthUI(null);
                navigateToHome(); 
            }
        });

        window.switchToRegister = function() {
            closeModal('loginModal');
            openModal('registerModal');
        }

        window.switchToLogin = function() {
            closeModal('registerModal');
            openModal('loginModal');
        }

        const registerForm = document.getElementById('registerForm');
        if (registerForm) {
            registerForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const name = document.getElementById('registerName').value.trim();
                const email = document.getElementById('registerEmail').value.trim();
                const password = document.getElementById('registerPassword').value;
                const confirmPassword = document.getElementById('registerConfirmPassword').value;
                const errorDiv = document.getElementById('registerError');
                errorDiv.style.display = 'none'; errorDiv.textContent = '';

                if (!name) { errorDiv.textContent = "Please enter your full name."; errorDiv.style.display = 'block'; return; }
                if (password !== confirmPassword) { errorDiv.textContent = "Passwords do not match!"; errorDiv.style.display = 'block'; return; }
                if (password.length < 6) { errorDiv.textContent = "Password should be at least 6 characters."; errorDiv.style.display = 'block'; return; }

                try {
                    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                    const user = userCredential.user;
                    await firebaseUpdateProfile(user, { displayName: name });
                    const userDocRef = doc(db, "users", user.uid);
                    await setDoc(userDocRef, {
                        uid: user.uid, displayName: name, email: user.email, photoURL: user.photoURL || null,
                        createdAt: serverTimestamp(), roles: ["guest"]
                    });
                    console.log("User registered:", user);
                    showInfoModal("Registration Successful!", \`Welcome, \${name}! Please complete your profile on the dashboard.\`);
                    closeModal('registerModal');
                    // onAuthStateChanged will handle UI and potentially navigate
                } catch (error) {
                    console.error("Registration error:", error.code, error.message);
                    errorDiv.textContent = error.message.replace('Firebase: ', '').replace('auth/', '').replace(/-/g, ' ');
                    errorDiv.style.display = 'block';
                }
            });
        }

        const loginForm = document.getElementById('loginForm');
        if (loginForm) {
            loginForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = document.getElementById('loginEmail').value.trim();
                const password = document.getElementById('loginPassword').value;
                const errorDiv = document.getElementById('loginError');
                errorDiv.style.display = 'none'; errorDiv.textContent = '';

                try {
                    const userCredential = await signInWithEmailAndPassword(auth, email, password);
                    console.log("User logged in:", userCredential.user);
                    closeModal('loginModal');
                    // onAuthStateChanged will handle UI and potentially navigate
                } catch (error) {
                    console.error("Login error:", error.code, error.message);
                    errorDiv.textContent = "Invalid email or password. Please try again.";
                    errorDiv.style.display = 'block';
                }
            });
        }
        
        window.handleGoogleSignIn = async function() {
            try {
                const result = await signInWithPopup(auth, googleProvider);
                const user = result.user;
                const userDocRef = doc(db, "users", user.uid);
                const userDocSnap = await getDoc(userDocRef);

                if (!userDocSnap.exists()) {
                    await setDoc(userDocRef, {
                        uid: user.uid, displayName: user.displayName, email: user.email,
                        photoURL: user.photoURL || null, createdAt: serverTimestamp(), roles: ["guest"]
                    });
                    console.log("New Google user created in Firestore:", user);
                    showInfoModal("Welcome to eKhaya!", \`Account created for \${user.displayName}. Please complete your profile.\`);
                } else {
                    console.log("Google Sign-In successful:", user);
                    showInfoModal("Login Successful!", \`Welcome back, \${user.displayName}!\`);
                }
                closeModal('loginModal'); closeModal('registerModal');
                // onAuthStateChanged will handle UI and potentially navigate
            } catch (error) {
                console.error("Google Sign-In error:", error.code, error.message);
                let friendlyMessage = "Google Sign-In failed. Please try again.";
                if (error.code === 'auth/popup-closed-by-user') friendlyMessage = "Google Sign-In cancelled.";
                if (error.code === 'auth/network-request-failed') friendlyMessage = "Network error. Please check connection.";
                showInfoModal("Google Sign-In Error", friendlyMessage, true);
            }
        }
        window.handleGoogleSignUp = window.handleGoogleSignIn;

        window.handleLogout = async function() {
            try {
                await signOut(auth);
                console.log("User logged out");
                showInfoModal("Logged Out", "You have been successfully logged out.");
                closeModal('profileModal'); // Close profile modal if it was open
                // onAuthStateChanged will navigate to home
            } catch (error) {
                console.error("Logout error:", error);
                showInfoModal("Logout Error", error.message, true);
            }
        }

        // --- Profile Management & Role Specific Fields ---
        if(roleTenantCheckbox && roleLandlordCheckbox) {
            roleTenantCheckbox.addEventListener('change', () => {
                tenantSpecificFieldsDiv.classList.toggle('hidden', !roleTenantCheckbox.checked);
            });
            roleLandlordCheckbox.addEventListener('change', () => {
                landlordSpecificFieldsDiv.classList.toggle('hidden', !roleLandlordCheckbox.checked);
            });
        }

        const profileUpdateForm = document.getElementById('profileUpdateForm');
        if (profileUpdateForm) {
            profileUpdateForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                if (!currentAuthUser) {
                    showInfoModal("Error", "You must be logged in to update your profile.", true);
                    return;
                }
                const errorDiv = document.getElementById('profileUpdateError');
                errorDiv.style.display = 'none'; errorDiv.textContent = '';

                const displayName = document.getElementById('profileDisplayName').value.trim();
                const phoneNumber = document.getElementById('profilePhoneNumber').value.trim();
                const bio = document.getElementById('profileBio').value.trim();
                const isTenant = document.getElementById('roleTenant').checked;
                const isLandlord = document.getElementById('roleLandlord').checked;
                
                let roles = [];
                if (isTenant) roles.push('tenant');
                if (isLandlord) roles.push('landlord');
                if (roles.length === 0) roles.push('guest'); // Default if none selected

                const landlordPropertiesCount = document.getElementById('landlordPropertiesCount').value;
                const landlordExperienceYears = document.getElementById('landlordExperienceYears').value;
                const landlordHostingStyle = document.getElementById('landlordHostingStyle').value.trim();
                const tenantLookingFor = document.getElementById('tenantLookingFor').value;
                const tenantBedrooms = document.getElementById('tenantBedrooms').value;
                const tenantIdealSituation = document.getElementById('tenantIdealSituation').value.trim();

                try {
                    const userDocRef = doc(db, "users", currentAuthUser.uid);
                    const updateData = {
                        displayName: displayName || currentAuthUser.displayName, 
                        phoneNumber: phoneNumber || null,
                        bio: bio || null,
                        roles: roles,
                        updatedAt: serverTimestamp()
                    };

                    if (isLandlord) {
                        updateData.landlordProfile = {
                            propertiesCount: landlordPropertiesCount ? parseInt(landlordPropertiesCount) : 0,
                            experienceYears: landlordExperienceYears ? parseInt(landlordExperienceYears) : 0,
                            hostingStyle: landlordHostingStyle || ""
                        };
                    }
                    if (isTenant) {
                        updateData.tenantProfile = {
                            lookingFor: tenantLookingFor || "",
                            bedrooms: tenantBedrooms ? parseInt(tenantBedrooms) : 0,
                            idealSituation: tenantIdealSituation || ""
                        };
                    }

                    await setDoc(userDocRef, updateData, { merge: true }); 

                    if (displayName && displayName !== currentAuthUser.displayName) {
                        await firebaseUpdateProfile(currentAuthUser, { displayName: displayName });
                    }
                    
                    showInfoModal("Profile Updated", "Your profile has been successfully updated.");
                    closeModal('editProfileModal');
                    await fetchUserProfile(currentAuthUser.uid); 
                    updateAuthUI(currentAuthUser); 
                    updateDashboardBasedOnRole(); 
                } catch (error) {
                    console.error("Error updating profile:", error);
                    errorDiv.textContent = "Error updating profile: " + error.message;
                    errorDiv.style.display = 'block';
                }
            });
        }

        window.populateProfileForm = function() {
            if (currentAuthUser && userProfileData) {
                document.getElementById('profileDisplayName').value = userProfileData.displayName || currentAuthUser.displayName || '';
                document.getElementById('profilePhoneNumber').value = userProfileData.phoneNumber || '';
                document.getElementById('profileBio').value = userProfileData.bio || '';
                
                const isTenant = userProfileData.roles?.includes('tenant') || false;
                const isLandlord = userProfileData.roles?.includes('landlord') || false;
                document.getElementById('roleTenant').checked = isTenant;
                document.getElementById('roleLandlord').checked = isLandlord;

                tenantSpecificFieldsDiv.classList.toggle('hidden', !isTenant);
                landlordSpecificFieldsDiv.classList.toggle('hidden', !isLandlord);

                if (isLandlord && userProfileData.landlordProfile) {
                    document.getElementById('landlordPropertiesCount').value = userProfileData.landlordProfile.propertiesCount || '';
                    document.getElementById('landlordExperienceYears').value = userProfileData.landlordProfile.experienceYears || '';
                    document.getElementById('landlordHostingStyle').value = userProfileData.landlordProfile.hostingStyle || '';
                }
                if (isTenant && userProfileData.tenantProfile) {
                    document.getElementById('tenantLookingFor').value = userProfileData.tenantProfile.lookingFor || '';
                    document.getElementById('tenantBedrooms').value = userProfileData.tenantProfile.bedrooms || '';
                    document.getElementById('tenantIdealSituation').value = userProfileData.tenantProfile.idealSituation || '';
                }

            } else if (currentAuthUser) { 
                 document.getElementById('profileDisplayName').value = currentAuthUser.displayName || '';
                 document.getElementById('profilePhoneNumber').value = '';
                 document.getElementById('profileBio').value = '';
                 document.getElementById('roleTenant').checked = true; 
                 document.getElementById('roleLandlord').checked = false;
                 tenantSpecificFieldsDiv.classList.remove('hidden');
                 landlordSpecificFieldsDiv.classList.add('hidden');
            }
        }
        
        const editProfileModal = document.getElementById('editProfileModal');
        if (editProfileModal) { 
            const observer = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.attributeName === "style" && editProfileModal.style.display === "flex" && currentAuthUser) {
                        if (!userProfileData || userProfileData.uid !== currentAuthUser.uid) {
                            fetchUserProfile(currentAuthUser.uid).then(() => {
                                populateProfileForm();
                            });
                        } else {
                            populateProfileForm();
                        }
                    }
                });
            });
            observer.observe(editProfileModal, { attributes: true });
        }

        // Initialize Swiper
        var swiper = new Swiper('.swiper-container', {
            loop: true,
            autoplay: { delay: 7000, disableOnInteraction: false, },
            pagination: { el: '.swiper-pagination', clickable: true, },
            navigation: { nextEl: '.swiper-button-next', prevEl: '.swiper-button-prev', },
            effect: 'fade', fadeEffect: { crossFade: true },
        });

    </script>
</body>
</html>
